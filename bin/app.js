// Generated by Haxe 4.3.6
(function ($global) { "use strict";
var $estr = function() { return js_Boot.__string_rec(this,''); },$hxEnums = $hxEnums || {},$_;
function $extend(from, fields) {
	var proto = Object.create(from);
	for (var name in fields) proto[name] = fields[name];
	if( fields.toString !== Object.prototype.toString ) proto.toString = fields.toString;
	return proto;
}
var EReg = function(r,opt) {
	this.r = new RegExp(r,opt.split("u").join(""));
};
EReg.__name__ = true;
EReg.prototype = {
	match: function(s) {
		if(this.r.global) {
			this.r.lastIndex = 0;
		}
		this.r.m = this.r.exec(s);
		this.r.s = s;
		return this.r.m != null;
	}
};
var FlowchartBuilder = function(templates,customParamTypes) {
	this.defaultConnectionTag = "";
	this.templates = templates;
	this.customParamTypes = customParamTypes != null ? customParamTypes : [];
};
FlowchartBuilder.__name__ = true;
FlowchartBuilder.prototype = {
	init: function() {
		var _gthis = this;
		console.log("src/FlowchartBuilder.hx:43:","Flowchart Builder Initialized");
		if(this.graph == null) {
			this.graph = new model_Graph();
		}
		if(this.notes == null) {
			this.notes = [];
		}
		this.transactionManager = new history_TransactionManager();
		this.canvasView = new ui_CanvasView("flowchart-canvas",this.graph,this.notes);
		this.paletteView = new ui_PaletteView("palette",this.templates);
		this.dialogView = new ui_DialogView("node-editor",this.customParamTypes);
		this.previewDialog = new ui_PreviewDialog("preview-dialog");
		this.optionsDialog = new ui_OptionsDialog("options-dialog");
		this.optionsDialog.onSave = function(newTag) {
			_gthis.defaultConnectionTag = newTag;
		};
		var contextMenu = new ui_ContextMenu();
		this.canvasView.onNodeCreate = function(templateName,x,y) {
			var template = _gthis.findTemplate(templateName);
			if(template != null) {
				var nodeId = "node_" + new Date().getTime() + "_" + Math.floor(Math.random() * 1000);
				var node = new model_FlowchartNode(nodeId,template,x,y);
				_gthis.transactionManager.add(new history_AddNodeTransaction(_gthis.graph,node));
				_gthis.graph.addNode(node);
				_gthis.canvasView.draw();
			}
		};
		this.canvasView.onEditNode = function(node) {
			_gthis.dialogView.open(node);
		};
		this.canvasView.onConnect = function(sourceId,targetId) {
			var source = _gthis.findNodeById(sourceId);
			var target = _gthis.findNodeById(targetId);
			if(source != null && target != null) {
				var conn = new model_GraphConnection(source,target,new model_FlowchartConnection(_gthis.defaultConnectionTag));
				_gthis.transactionManager.add(new history_ConnectTransaction(_gthis.graph,conn));
				_gthis.graph.addEdge(conn);
				_gthis.canvasView.draw();
			}
		};
		this.canvasView.onMoveNode = function(node,startX,startY,endX,endY) {
			if(startX != endX || startY != endY) {
				_gthis.transactionManager.add(new history_MoveNodeTransaction(node,startX,startY,endX,endY));
			}
		};
		this.canvasView.onMoveNote = function(note,startX,startY,endX,endY) {
			if(startX != endX || startY != endY) {
				_gthis.transactionManager.add(new history_MoveNoteTransaction(note,startX,startY,endX,endY));
			}
		};
		this.canvasView.onResizeNote = function(note,startW,startH,endW,endH) {
			if(startW != endW || startH != endH) {
				_gthis.transactionManager.add(new history_ResizeNoteTransaction(note,startW,startH,endW,endH));
			}
		};
		this.canvasView.onEditConnection = function(edge) {
			var tag = window.prompt("Edit Connection Tag:",edge.edge.tag);
			if(tag != null) {
				edge.edge.tag = tag;
				_gthis.canvasView.draw();
			}
		};
		this.canvasView.onEditNoteText = function(note) {
			_gthis.dialogView.openNote(note);
		};
		this.dialogView.onSaveNote = function(note) {
			_gthis.canvasView.draw();
		};
		this.canvasView.onContextMenu = function(x,y,targetType,targetId) {
			var items = [];
			if(targetType == "node") {
				items.push({ label : "Delete Node", action : function() {
					var node = _gthis.findNodeById(targetId);
					if(node != null) {
						_gthis.transactionManager.add(new history_DeleteNodeTransaction(_gthis.graph,node));
						_gthis.graph.removeNode(node);
						var edges = _gthis.graph.adjacent(node);
						var _g = 0;
						while(_g < edges.length) {
							var e = edges[_g];
							++_g;
							_gthis.graph.removeEdge(e);
						}
						_gthis.canvasView.draw();
					}
				}});
			} else if(targetType == "connection") {
				items.push({ label : "Delete Connection", action : function() {
				}});
			} else if(targetType == "note") {
				items.push({ label : "Delete Note", action : function() {
					var note = _gthis.findNoteById(targetId);
					if(note != null) {
						_gthis.transactionManager.add(new history_DeleteNoteTransaction(_gthis.notes,note));
						HxOverrides.remove(_gthis.notes,note);
						_gthis.canvasView.draw();
					}
				}});
			}
			if(items.length > 0) {
				contextMenu.show(x,y,items);
			}
		};
		this.canvasView.onConnectionContextMenu = function(x,y,conn) {
			contextMenu.show(x,y,[{ label : "Delete Connection", action : function() {
				_gthis.transactionManager.add(new history_DisconnectTransaction(_gthis.graph,conn));
				_gthis.graph.removeEdge(conn);
				_gthis.canvasView.draw();
			}}]);
		};
		this.dialogView.onSave = function(node) {
			_gthis.canvasView.draw();
		};
		this.setupToolbar();
		this.setupNoteButton();
		this.setupShortcuts();
	}
	,setupShortcuts: function() {
		var _gthis = this;
		window.addEventListener("keydown",function(e) {
			if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() == "z") {
				if(e.shiftKey) {
					_gthis.transactionManager.redo();
				} else {
					_gthis.transactionManager.undo();
				}
				_gthis.canvasView.draw();
				e.preventDefault();
			} else if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() == "y") {
				_gthis.transactionManager.redo();
				_gthis.canvasView.draw();
				e.preventDefault();
			}
		});
	}
	,setupNoteButton: function() {
		var _gthis = this;
		var btnAddNote = window.document.getElementById("btn-add-note");
		if(btnAddNote != null) {
			btnAddNote.onclick = function() {
				var noteId = "note_" + new Date().getTime();
				var note = new model_Note(noteId,"New Note",100,100);
				_gthis.transactionManager.add(new history_AddNoteTransaction(_gthis.notes,note));
				_gthis.notes.push(note);
				_gthis.canvasView.draw();
			};
		}
	}
	,findNodeById: function(id) {
		var _g = 0;
		var _g1 = this.graph.nodes;
		while(_g < _g1.length) {
			var n = _g1[_g];
			++_g;
			if(n.id == id) {
				return n;
			}
		}
		return null;
	}
	,findNoteById: function(id) {
		var _g = 0;
		var _g1 = this.notes;
		while(_g < _g1.length) {
			var n = _g1[_g];
			++_g;
			if(n.id == id) {
				return n;
			}
		}
		return null;
	}
	,findTemplate: function(name) {
		var _g = 0;
		var _g1 = this.templates;
		while(_g < _g1.length) {
			var t = _g1[_g];
			++_g;
			if(t.name == name) {
				return t;
			}
		}
		return null;
	}
	,setupToolbar: function() {
		var _gthis = this;
		var btnSave = window.document.getElementById("btn-save");
		var btnLoad = window.document.getElementById("btn-load");
		var btnOptions = window.document.getElementById("btn-options");
		var btnPreview = window.document.getElementById("btn-preview");
		var fileInput = window.document.getElementById("file-input");
		if(btnSave != null) {
			btnSave.onclick = function() {
				if(_gthis.onSave != null) {
					_gthis.onSave();
					return;
				}
				var _gthis1 = _gthis.graph.nodes;
				var _this = _gthis.graph.edges;
				var result = new Array(_this.length);
				var _g = 0;
				var _g1 = _this.length;
				while(_g < _g1) {
					var i = _g++;
					var e = _this[i];
					result[i] = { sourceId : e.source.id, targetId : e.target.id, tag : e.edge.tag};
				}
				var data = { nodes : _gthis1, edges : result, notes : _gthis.notes};
				var json = JSON.stringify(data,null,"  ");
				var blob = new Blob([json],{ type : "application/json"});
				var url = URL.createObjectURL(blob);
				var a = window.document.createElement("a");
				a.href = url;
				a.download = "flowchart.json";
				a.click();
				URL.revokeObjectURL(url);
			};
		}
		if(btnLoad != null) {
			btnLoad.onclick = function() {
				fileInput.click();
			};
		}
		if(fileInput != null) {
			fileInput.onchange = function(e) {
				if(fileInput.files.length > 0) {
					var file = fileInput.files[0];
					var reader = new FileReader();
					reader.onload = function(e) {
						try {
							var json = reader.result;
							var data = JSON.parse(json);
							_gthis.graph = new model_Graph();
							_gthis.notes = [];
							if(data.nodes != null) {
								var nodesList = data.nodes;
								var _g = 0;
								while(_g < nodesList.length) {
									var nData = nodesList[_g];
									++_g;
									var templateName = nData.template.name;
									var template = _gthis.findTemplate(templateName);
									if(template != null) {
										var node = new model_FlowchartNode(nData.id,template,nData.x,nData.y);
										var dataMap = nData.data;
										var _g1 = 0;
										var _g2 = Reflect.fields(dataMap);
										while(_g1 < _g2.length) {
											var field = _g2[_g1];
											++_g1;
											node.data.h[field] = Reflect.field(dataMap,field);
										}
										_gthis.graph.addNode(node);
									}
								}
							}
							if(data.edges != null) {
								var edgesList = data.edges;
								var _g = 0;
								while(_g < edgesList.length) {
									var eData = edgesList[_g];
									++_g;
									var source = _gthis.findNodeById(eData.sourceId);
									var target = _gthis.findNodeById(eData.targetId);
									if(source != null && target != null) {
										var conn = new model_GraphConnection(source,target,new model_FlowchartConnection(eData.tag));
										_gthis.graph.addEdge(conn);
									}
								}
							}
							if(data.notes != null) {
								var notesList = data.notes;
								var _g = 0;
								while(_g < notesList.length) {
									var nData = notesList[_g];
									++_g;
									var w = nData.width != null ? nData.width : 200;
									var h = nData.height != null ? nData.height : 150;
									var note = new model_Note(nData.id,nData.text,nData.x,nData.y,w,h);
									_gthis.notes.push(note);
								}
							}
							_gthis.canvasView.graph = _gthis.graph;
							_gthis.canvasView.notes = _gthis.notes;
							_gthis.transactionManager = new history_TransactionManager();
							_gthis.canvasView.draw();
						} catch( _g ) {
							var err = haxe_Exception.caught(_g).unwrap();
							window.alert("Error loading file: " + Std.string(err));
							console.log("src/FlowchartBuilder.hx:394:",err);
						}
					};
					reader.readAsText(file);
				}
				fileInput.value = "";
			};
		}
		if(btnOptions != null) {
			btnOptions.onclick = function() {
				_gthis.optionsDialog.open(_gthis.defaultConnectionTag);
			};
		}
		if(btnPreview != null) {
			btnPreview.onclick = function() {
				_gthis.previewDialog.showOptions({ onTemplates : function() {
					var json = JSON.stringify(_gthis.templates,null,"  ");
					_gthis.previewDialog.showContent("Templates",json);
				}, onFlowchart : function() {
					var _this = _gthis.graph.nodes;
					var result = new Array(_this.length);
					var _g = 0;
					var _g1 = _this.length;
					while(_g < _g1) {
						var i = _g++;
						var node = _this[i];
						var dataObj = { };
						var h = node.data.h;
						var k_h = h;
						var k_keys = Object.keys(h);
						var k_length = k_keys.length;
						var k_current = 0;
						while(k_current < k_length) {
							var k = k_keys[k_current++];
							dataObj[k] = node.data.h[k];
						}
						result[i] = { id : node.id, x : node.x, y : node.y, template : node.template.name, data : dataObj};
					}
					var nodes = result;
					var json = JSON.stringify(nodes,null,"  ");
					_gthis.previewDialog.showContent("Flowchart Nodes",json);
				}, onCode : function() {
					var serializer = new serialize_FlowchartSerializer();
					var code = serializer.write(_gthis.graph);
					_gthis.previewDialog.showContent("Generated Code",code);
				}});
			};
		}
	}
};
var HxOverrides = function() { };
HxOverrides.__name__ = true;
HxOverrides.remove = function(a,obj) {
	var i = a.indexOf(obj);
	if(i == -1) {
		return false;
	}
	a.splice(i,1);
	return true;
};
HxOverrides.now = function() {
	return Date.now();
};
var Main = function() { };
Main.__name__ = true;
Main.main = function() {
	var commonSerialization_attachToNodeTemplate = "{0}.attach({1}, {2});";
	var commonSerialization_attachToRootTemplate = "{0}.start();";
	var templates = [{ name : "Start", category : "Flow", params : [], cssStyles : { }, serialization : { initializationTemplate : "var {0} = new Start({1});", attachToNodeTemplate : "{0}.attach({1}, {2});", attachToRootTemplate : "{0}.start();"}},{ name : "Show Text", category : "Events", params : [model_NodeParameter.Textarea("text","Message Text","Hello World"),model_NodeParameter.Dropdown("position","Position","Bottom",["Top","Middle","Bottom"])], cssStyles : { }, serialization : { initializationTemplate : "var {0} = new ShowText({1});", attachToNodeTemplate : "{0}.attach({1}, {2});", attachToRootTemplate : "{0}.start();"}},{ name : "Wait", category : "Events", params : [model_NodeParameter.Number("duration","Duration (seconds)",1.0)], cssStyles : { }, serialization : { initializationTemplate : "var {0} = new Wait({1});", attachToNodeTemplate : "{0}.attach({1}, {2});", attachToRootTemplate : "{0}.start();"}},{ name : "Choice", category : "Logic", params : [model_NodeParameter.Array("options","Options",[])], cssStyles : { }, serialization : { initializationTemplate : "var {0} = new Choice({1});", attachToNodeTemplate : "{0}.attach({1}, {2});", attachToRootTemplate : "{0}.start();"}},{ name : "Color Node", category : "Custom Example", params : [model_NodeParameter.Custom("color","Background Color",{ typeName : "Color"})], cssStyles : { }, serialization : { initializationTemplate : "var {0} = new ColorNode({1});", attachToNodeTemplate : "{0}.attach({1}, {2});", attachToRootTemplate : "{0}.start();"}}];
	var customTypes = [{ typeName : "Color", renderControl : function(containerId,initialValue) {
		return new ColorPickerControl(initialValue);
	}}];
	window.onload = function(_) {
		var builder = new FlowchartBuilder(templates,customTypes);
		builder.init();
	};
};
var ColorPickerControl = function(initialValue) {
	this.input = window.document.createElement("input");
	this.input.type = "color";
	this.input.value = initialValue != null && initialValue != "" ? Std.string(initialValue) : "#ff0000";
	this.input.style.width = "100%";
	this.input.style.height = "40px";
	this.input.style.cursor = "pointer";
};
ColorPickerControl.__name__ = true;
ColorPickerControl.prototype = {
	getValue: function() {
		return this.input.value;
	}
	,getElement: function() {
		return this.input;
	}
};
Math.__name__ = true;
var Reflect = function() { };
Reflect.__name__ = true;
Reflect.field = function(o,field) {
	try {
		return o[field];
	} catch( _g ) {
		return null;
	}
};
Reflect.fields = function(o) {
	var a = [];
	if(o != null) {
		var hasOwnProperty = Object.prototype.hasOwnProperty;
		for( var f in o ) {
		if(f != "__id__" && f != "hx__closures__" && hasOwnProperty.call(o,f)) {
			a.push(f);
		}
		}
	}
	return a;
};
Reflect.compare = function(a,b) {
	if(a == b) {
		return 0;
	} else if(a > b) {
		return 1;
	} else {
		return -1;
	}
};
var Std = function() { };
Std.__name__ = true;
Std.string = function(s) {
	return js_Boot.__string_rec(s,"");
};
var StringTools = function() { };
StringTools.__name__ = true;
StringTools.replace = function(s,sub,by) {
	return s.split(sub).join(by);
};
var haxe_Exception = function(message,previous,native) {
	Error.call(this,message);
	this.message = message;
	this.__previousException = previous;
	this.__nativeException = native != null ? native : this;
};
haxe_Exception.__name__ = true;
haxe_Exception.caught = function(value) {
	if(((value) instanceof haxe_Exception)) {
		return value;
	} else if(((value) instanceof Error)) {
		return new haxe_Exception(value.message,null,value);
	} else {
		return new haxe_ValueException(value,null,value);
	}
};
haxe_Exception.__super__ = Error;
haxe_Exception.prototype = $extend(Error.prototype,{
	unwrap: function() {
		return this.__nativeException;
	}
});
var haxe_Timer = function(time_ms) {
	var me = this;
	this.id = setInterval(function() {
		me.run();
	},time_ms);
};
haxe_Timer.__name__ = true;
haxe_Timer.delay = function(f,time_ms) {
	var t = new haxe_Timer(time_ms);
	t.run = function() {
		t.stop();
		f();
	};
	return t;
};
haxe_Timer.prototype = {
	stop: function() {
		if(this.id == null) {
			return;
		}
		clearInterval(this.id);
		this.id = null;
	}
	,run: function() {
	}
};
var haxe_ValueException = function(value,previous,native) {
	haxe_Exception.call(this,String(value),previous,native);
	this.value = value;
};
haxe_ValueException.__name__ = true;
haxe_ValueException.__super__ = haxe_Exception;
haxe_ValueException.prototype = $extend(haxe_Exception.prototype,{
	unwrap: function() {
		return this.value;
	}
});
var haxe_ds_StringMap = function() {
	this.h = Object.create(null);
};
haxe_ds_StringMap.__name__ = true;
var haxe_iterators_ArrayIterator = function(array) {
	this.current = 0;
	this.array = array;
};
haxe_iterators_ArrayIterator.__name__ = true;
haxe_iterators_ArrayIterator.prototype = {
	hasNext: function() {
		return this.current < this.array.length;
	}
	,next: function() {
		return this.array[this.current++];
	}
};
var history_TransactionManager = function() {
	this.undoStack = [];
	this.redoStack = [];
	this.isExecuting = false;
};
history_TransactionManager.__name__ = true;
history_TransactionManager.prototype = {
	add: function(transaction) {
		if(this.isExecuting) {
			return;
		}
		this.undoStack.push(transaction);
		this.redoStack = [];
	}
	,undo: function() {
		if(this.undoStack.length == 0) {
			return;
		}
		var transaction = this.undoStack.pop();
		this.isExecuting = true;
		transaction.undo();
		this.isExecuting = false;
		this.redoStack.push(transaction);
		ui_Toast.show("Undo: " + transaction.getLabel());
	}
	,redo: function() {
		if(this.redoStack.length == 0) {
			return;
		}
		var transaction = this.redoStack.pop();
		this.isExecuting = true;
		transaction.redo();
		this.isExecuting = false;
		this.undoStack.push(transaction);
		ui_Toast.show("Redo: " + transaction.getLabel());
	}
};
var history_AddNodeTransaction = function(graph,node) {
	this.graph = graph;
	this.node = node;
};
history_AddNodeTransaction.__name__ = true;
history_AddNodeTransaction.prototype = {
	undo: function() {
		this.graph.removeNode(this.node);
	}
	,redo: function() {
		this.graph.addNode(this.node);
	}
	,getLabel: function() {
		return "Add Node " + this.node.template.name;
	}
};
var history_DeleteNodeTransaction = function(graph,node) {
	this.graph = graph;
	this.node = node;
	this.connectedEdges = graph.adjacent(node);
};
history_DeleteNodeTransaction.__name__ = true;
history_DeleteNodeTransaction.prototype = {
	undo: function() {
		this.graph.addNode(this.node);
		var _g = 0;
		var _g1 = this.connectedEdges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			this.graph.addEdge(edge);
		}
	}
	,redo: function() {
		var _g = 0;
		var _g1 = this.connectedEdges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			this.graph.removeEdge(edge);
		}
		this.graph.removeNode(this.node);
	}
	,getLabel: function() {
		return "Delete Node";
	}
};
var history_MoveNodeTransaction = function(node,startX,startY,endX,endY) {
	this.node = node;
	this.startX = startX;
	this.startY = startY;
	this.endX = endX;
	this.endY = endY;
};
history_MoveNodeTransaction.__name__ = true;
history_MoveNodeTransaction.prototype = {
	undo: function() {
		this.node.x = this.startX;
		this.node.y = this.startY;
	}
	,redo: function() {
		this.node.x = this.endX;
		this.node.y = this.endY;
	}
	,getLabel: function() {
		return "Move Node";
	}
};
var history_ConnectTransaction = function(graph,connection) {
	this.graph = graph;
	this.connection = connection;
};
history_ConnectTransaction.__name__ = true;
history_ConnectTransaction.prototype = {
	undo: function() {
		this.graph.removeEdge(this.connection);
	}
	,redo: function() {
		this.graph.addEdge(this.connection);
	}
	,getLabel: function() {
		return "Connect Nodes";
	}
};
var history_DisconnectTransaction = function(graph,connection) {
	this.graph = graph;
	this.connection = connection;
};
history_DisconnectTransaction.__name__ = true;
history_DisconnectTransaction.prototype = {
	undo: function() {
		this.graph.addEdge(this.connection);
	}
	,redo: function() {
		this.graph.removeEdge(this.connection);
	}
	,getLabel: function() {
		return "Delete Connection";
	}
};
var history_AddNoteTransaction = function(notes,note) {
	this.notes = notes;
	this.note = note;
};
history_AddNoteTransaction.__name__ = true;
history_AddNoteTransaction.prototype = {
	undo: function() {
		HxOverrides.remove(this.notes,this.note);
	}
	,redo: function() {
		this.notes.push(this.note);
	}
	,getLabel: function() {
		return "Add Note";
	}
};
var history_DeleteNoteTransaction = function(notes,note) {
	this.notes = notes;
	this.note = note;
};
history_DeleteNoteTransaction.__name__ = true;
history_DeleteNoteTransaction.prototype = {
	undo: function() {
		this.notes.push(this.note);
	}
	,redo: function() {
		HxOverrides.remove(this.notes,this.note);
	}
	,getLabel: function() {
		return "Delete Note";
	}
};
var history_MoveNoteTransaction = function(note,startX,startY,endX,endY) {
	this.note = note;
	this.startX = startX;
	this.startY = startY;
	this.endX = endX;
	this.endY = endY;
};
history_MoveNoteTransaction.__name__ = true;
history_MoveNoteTransaction.prototype = {
	undo: function() {
		this.note.x = this.startX;
		this.note.y = this.startY;
	}
	,redo: function() {
		this.note.x = this.endX;
		this.note.y = this.endY;
	}
	,getLabel: function() {
		return "Move Note";
	}
};
var history_ResizeNoteTransaction = function(note,startWidth,startHeight,endWidth,endHeight) {
	this.note = note;
	this.startWidth = startWidth;
	this.startHeight = startHeight;
	this.endWidth = endWidth;
	this.endHeight = endHeight;
};
history_ResizeNoteTransaction.__name__ = true;
history_ResizeNoteTransaction.prototype = {
	undo: function() {
		this.note.width = this.startWidth;
		this.note.height = this.startHeight;
	}
	,redo: function() {
		this.note.width = this.endWidth;
		this.note.height = this.endHeight;
	}
	,getLabel: function() {
		return "Resize Note";
	}
};
var js_Boot = function() { };
js_Boot.__name__ = true;
js_Boot.__string_rec = function(o,s) {
	if(o == null) {
		return "null";
	}
	if(s.length >= 5) {
		return "<...>";
	}
	var t = typeof(o);
	if(t == "function" && (o.__name__ || o.__ename__)) {
		t = "object";
	}
	switch(t) {
	case "function":
		return "<function>";
	case "object":
		if(o.__enum__) {
			var e = $hxEnums[o.__enum__];
			var con = e.__constructs__[o._hx_index];
			var n = con._hx_name;
			if(con.__params__) {
				s = s + "\t";
				return n + "(" + ((function($this) {
					var $r;
					var _g = [];
					{
						var _g1 = 0;
						var _g2 = con.__params__;
						while(true) {
							if(!(_g1 < _g2.length)) {
								break;
							}
							var p = _g2[_g1];
							_g1 = _g1 + 1;
							_g.push(js_Boot.__string_rec(o[p],s));
						}
					}
					$r = _g;
					return $r;
				}(this))).join(",") + ")";
			} else {
				return n;
			}
		}
		if(((o) instanceof Array)) {
			var str = "[";
			s += "\t";
			var _g = 0;
			var _g1 = o.length;
			while(_g < _g1) {
				var i = _g++;
				str += (i > 0 ? "," : "") + js_Boot.__string_rec(o[i],s);
			}
			str += "]";
			return str;
		}
		var tostr;
		try {
			tostr = o.toString;
		} catch( _g ) {
			return "???";
		}
		if(tostr != null && tostr != Object.toString && typeof(tostr) == "function") {
			var s2 = o.toString();
			if(s2 != "[object Object]") {
				return s2;
			}
		}
		var str = "{\n";
		s += "\t";
		var hasp = o.hasOwnProperty != null;
		var k = null;
		for( k in o ) {
		if(hasp && !o.hasOwnProperty(k)) {
			continue;
		}
		if(k == "prototype" || k == "__class__" || k == "__super__" || k == "__interfaces__" || k == "__properties__") {
			continue;
		}
		if(str.length != 2) {
			str += ", \n";
		}
		str += s + k + " : " + js_Boot.__string_rec(o[k],s);
		}
		s = s.substring(1);
		str += "\n" + s + "}";
		return str;
	case "string":
		return o;
	default:
		return String(o);
	}
};
var model_FlowchartConnection = function(tag) {
	this.tag = tag;
};
model_FlowchartConnection.__name__ = true;
var model_FlowchartNode = function(id,template,x,y) {
	this.id = id;
	this.template = template;
	this.x = x;
	this.y = y;
	this.data = new haxe_ds_StringMap();
	var _g = 0;
	var _g1 = template.params;
	while(_g < _g1.length) {
		var param = _g1[_g];
		++_g;
		switch(param._hx_index) {
		case 0:
			var _g2 = param.description;
			var name = param.name;
			var def = param.defaultValue;
			this.data.h[name] = def;
			break;
		case 1:
			var _g3 = param.description;
			var name1 = param.name;
			var def1 = param.defaultValue;
			this.data.h[name1] = def1;
			break;
		case 2:
			var _g4 = param.description;
			var name2 = param.name;
			var def2 = param.defaultValue;
			this.data.h[name2] = def2;
			break;
		case 3:
			var _g5 = param.description;
			var name3 = param.name;
			var def3 = param.defaultValue;
			this.data.h[name3] = def3;
			break;
		case 4:
			var _g6 = param.description;
			var _g7 = param.options;
			var name4 = param.name;
			var def4 = param.defaultValue;
			this.data.h[name4] = def4;
			break;
		case 5:
			var _g8 = param.description;
			var name5 = param.name;
			var def5 = param.defaultValue;
			this.data.h[name5] = def5;
			break;
		case 6:
			var _g9 = param.description;
			var name6 = param.name;
			var def6 = param.defaultValue;
			this.data.h[name6] = def6;
			break;
		case 7:
			var _g10 = param.description;
			var _g11 = param.custom;
			var name7 = param.name;
			this.data.h[name7] = null;
			break;
		}
	}
};
model_FlowchartNode.__name__ = true;
var model_Graph = function() {
	this.nodes = [];
	this.edges = [];
};
model_Graph.__name__ = true;
model_Graph.prototype = {
	adjacent: function(node) {
		var _g = [];
		var _g1 = 0;
		var _g2 = this.edges;
		while(_g1 < _g2.length) {
			var v = _g2[_g1];
			++_g1;
			if(v.source == node || v.target == node) {
				_g.push(v);
			}
		}
		return _g;
	}
	,addNode: function(node) {
		this.nodes.push(node);
	}
	,addEdge: function(edge) {
		this.edges.push(edge);
	}
	,removeNode: function(node) {
		var _g = [];
		var _g1 = 0;
		var _g2 = this.nodes;
		while(_g1 < _g2.length) {
			var v = _g2[_g1];
			++_g1;
			if(v != node) {
				_g.push(v);
			}
		}
		this.nodes = _g;
	}
	,removeEdge: function(edge) {
		var _g = [];
		var _g1 = 0;
		var _g2 = this.edges;
		while(_g1 < _g2.length) {
			var v = _g2[_g1];
			++_g1;
			if(v != edge) {
				_g.push(v);
			}
		}
		this.edges = _g;
	}
};
var model_GraphConnection = function(source,target,edge) {
	this.source = source;
	this.target = target;
	this.edge = edge;
};
model_GraphConnection.__name__ = true;
var model_NodeParameter = $hxEnums["model.NodeParameter"] = { __ename__:true,__constructs__:null
	,String: ($_=function(name,description,defaultValue) { return {_hx_index:0,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="String",$_.__params__ = ["name","description","defaultValue"],$_)
	,Number: ($_=function(name,description,defaultValue) { return {_hx_index:1,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Number",$_.__params__ = ["name","description","defaultValue"],$_)
	,Boolean: ($_=function(name,description,defaultValue) { return {_hx_index:2,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Boolean",$_.__params__ = ["name","description","defaultValue"],$_)
	,Array: ($_=function(name,description,defaultValue) { return {_hx_index:3,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Array",$_.__params__ = ["name","description","defaultValue"],$_)
	,Dropdown: ($_=function(name,description,defaultValue,options) { return {_hx_index:4,name:name,description:description,defaultValue:defaultValue,options:options,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Dropdown",$_.__params__ = ["name","description","defaultValue","options"],$_)
	,Textarea: ($_=function(name,description,defaultValue) { return {_hx_index:5,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Textarea",$_.__params__ = ["name","description","defaultValue"],$_)
	,File: ($_=function(name,description,defaultValue) { return {_hx_index:6,name:name,description:description,defaultValue:defaultValue,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="File",$_.__params__ = ["name","description","defaultValue"],$_)
	,Custom: ($_=function(name,description,custom) { return {_hx_index:7,name:name,description:description,custom:custom,__enum__:"model.NodeParameter",toString:$estr}; },$_._hx_name="Custom",$_.__params__ = ["name","description","custom"],$_)
};
model_NodeParameter.__constructs__ = [model_NodeParameter.String,model_NodeParameter.Number,model_NodeParameter.Boolean,model_NodeParameter.Array,model_NodeParameter.Dropdown,model_NodeParameter.Textarea,model_NodeParameter.File,model_NodeParameter.Custom];
var model_Note = function(id,text,x,y,width,height) {
	if(height == null) {
		height = 150;
	}
	if(width == null) {
		width = 200;
	}
	this.id = id;
	this.text = text;
	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;
};
model_Note.__name__ = true;
var serialize_FlowchartSerializer = function() {
};
serialize_FlowchartSerializer.__name__ = true;
serialize_FlowchartSerializer.prototype = {
	write: function(graph) {
		var sb_b = "";
		sb_b += "// Flowchart Generated Code\n";
		sb_b += "function runFlowchart() {\n";
		var getVarName = function(node) {
			var _this_r = new RegExp("[^a-zA-Z0-9_]","g".split("u").join(""));
			var safeId = node.id.replace(_this_r,"_");
			if(new EReg("^[0-9]","").match(safeId)) {
				safeId = "_" + safeId;
			}
			return safeId;
		};
		var getConstructorArgs = function(node) {
			var args = [];
			var _g = 0;
			var _g1 = node.template.params;
			while(_g < _g1.length) {
				var param = _g1[_g];
				++_g;
				var paramName = "";
				switch(param._hx_index) {
				case 0:
					var _g2 = param.description;
					var _g3 = param.defaultValue;
					var name = param.name;
					paramName = name;
					break;
				case 1:
					var _g4 = param.description;
					var _g5 = param.defaultValue;
					var name1 = param.name;
					paramName = name1;
					break;
				case 2:
					var _g6 = param.description;
					var _g7 = param.defaultValue;
					var name2 = param.name;
					paramName = name2;
					break;
				case 3:
					var _g8 = param.description;
					var _g9 = param.defaultValue;
					var name3 = param.name;
					paramName = name3;
					break;
				case 4:
					var _g10 = param.description;
					var _g11 = param.defaultValue;
					var _g12 = param.options;
					var name4 = param.name;
					paramName = name4;
					break;
				case 5:
					var _g13 = param.description;
					var _g14 = param.defaultValue;
					var name5 = param.name;
					paramName = name5;
					break;
				case 6:
					var _g15 = param.description;
					var _g16 = param.defaultValue;
					var name6 = param.name;
					paramName = name6;
					break;
				case 7:
					var _g17 = param.description;
					var _g18 = param.custom;
					var name7 = param.name;
					paramName = name7;
					break;
				}
				var value = node.data.h[paramName];
				var argStr = "null";
				if(value != null) {
					switch(param._hx_index) {
					case 0:
						var _g19 = param.name;
						var _g20 = param.description;
						var _g21 = param.defaultValue;
						argStr = JSON.stringify(value);
						break;
					case 1:
						var _g22 = param.name;
						var _g23 = param.description;
						var _g24 = param.defaultValue;
						argStr = Std.string(value);
						break;
					case 2:
						var _g25 = param.name;
						var _g26 = param.description;
						var _g27 = param.defaultValue;
						argStr = Std.string(value);
						break;
					case 3:
						var _g28 = param.name;
						var _g29 = param.description;
						var _g30 = param.defaultValue;
						argStr = JSON.stringify(value);
						break;
					case 4:
						var _g31 = param.name;
						var _g32 = param.description;
						var _g33 = param.defaultValue;
						var _g34 = param.options;
						argStr = JSON.stringify(value);
						break;
					case 5:
						var _g35 = param.name;
						var _g36 = param.description;
						var _g37 = param.defaultValue;
						argStr = JSON.stringify(value);
						break;
					case 6:
						var _g38 = param.name;
						var _g39 = param.description;
						var _g40 = param.defaultValue;
						argStr = JSON.stringify(value);
						break;
					case 7:
						var _g41 = param.name;
						var _g42 = param.description;
						var _g43 = param.custom;
						argStr = "null";
						break;
					}
				}
				args.push(argStr);
			}
			return args.join(", ");
		};
		var _g = 0;
		var _g1 = graph.nodes;
		while(_g < _g1.length) {
			var node = _g1[_g];
			++_g;
			var serialization = node.template.serialization;
			if(serialization != null) {
				var varName = getVarName(node);
				var args = getConstructorArgs(node);
				var code = StringTools.replace(serialization.initializationTemplate,"{0}",varName);
				code = StringTools.replace(code,"{1}",args);
				sb_b += Std.string(this.indent(code));
				sb_b += "\n";
			}
		}
		sb_b += "\n";
		var _g = 0;
		var _g1 = graph.edges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			var source = edge.source;
			var target = edge.target;
			var sourceSerialization = source.template.serialization;
			var targetSerialization = target.template.serialization;
			if(sourceSerialization != null && targetSerialization != null) {
				var sourceVar = getVarName(source);
				var targetVar = getVarName(target);
				var tag = edge.edge.tag != null ? edge.edge.tag : "";
				var tagStr = JSON.stringify(tag);
				var code = StringTools.replace(sourceSerialization.attachToNodeTemplate,"{0}",sourceVar);
				code = StringTools.replace(code,"{1}",targetVar);
				code = StringTools.replace(code,"{2}",tagStr);
				sb_b += Std.string(this.indent(code));
				sb_b += "\n";
			}
		}
		sb_b += "\n";
		var targets_h = Object.create(null);
		var _g = 0;
		var _g1 = graph.edges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			targets_h[edge.target.id] = true;
		}
		var _g = 0;
		var _g1 = graph.nodes;
		while(_g < _g1.length) {
			var node = _g1[_g];
			++_g;
			if(!Object.prototype.hasOwnProperty.call(targets_h,node.id)) {
				var serialization = node.template.serialization;
				if(serialization != null) {
					var varName = getVarName(node);
					var code = StringTools.replace(serialization.attachToRootTemplate,"{0}",varName);
					sb_b += Std.string(this.indent(code));
					sb_b += "\n";
				}
			}
		}
		sb_b += "}\n";
		return sb_b;
	}
	,indent: function(str) {
		var lines = str.split("\n");
		var _g = 0;
		var _g1 = lines.length;
		while(_g < _g1) {
			var i = _g++;
			if(lines[i].length > 0) {
				lines[i] = "    " + lines[i];
			}
		}
		return lines.join("\n");
	}
};
var ui_CanvasView = function(canvasId,graph,notes) {
	this.selectedConnection = null;
	this.selectedNoteId = null;
	this.selectedNodeId = null;
	this.mouseY = 0;
	this.mouseX = 0;
	this.isConnecting = false;
	this.resizeStartHeight = 0;
	this.resizeStartWidth = 0;
	this.nodeStartY = 0;
	this.nodeStartX = 0;
	this.dragStartY = 0;
	this.dragStartX = 0;
	this.isResizingNote = false;
	this.isDraggingNote = false;
	this.isDraggingNode = false;
	this.panStartOffsetY = 0;
	this.panStartOffsetX = 0;
	this.panStartY = 0;
	this.panStartX = 0;
	this.isPanning = false;
	this.scale = 1.0;
	this.offsetY = 0;
	this.offsetX = 0;
	this.graph = graph;
	this.notes = notes;
	this.canvas = window.document.getElementById(canvasId);
	this.ctx = this.canvas.getContext("2d",null);
	window.addEventListener("resize",$bind(this,this.onResize));
	this.onResize();
	this.canvas.addEventListener("mousedown",$bind(this,this.onMouseDown));
	this.canvas.addEventListener("mousemove",$bind(this,this.onMouseMove));
	this.canvas.addEventListener("mouseup",$bind(this,this.onMouseUp));
	this.canvas.addEventListener("wheel",$bind(this,this.onWheel));
	this.canvas.addEventListener("dblclick",$bind(this,this.onDoubleClick));
	this.canvas.addEventListener("contextmenu",$bind(this,this.onContextMenuEvent));
	this.canvas.addEventListener("dragover",$bind(this,this.onDragOver));
	this.canvas.addEventListener("drop",$bind(this,this.onDrop));
	window.requestAnimationFrame($bind(this,this.render));
};
ui_CanvasView.__name__ = true;
ui_CanvasView.prototype = {
	onNodeCreate: function(templateName,x,y) {
	}
	,onEditNode: function(node) {
	}
	,onEditConnection: function(edge) {
	}
	,onConnect: function(sourceId,targetId) {
	}
	,onMoveNode: function(node,startX,startY,endX,endY) {
	}
	,onMoveNote: function(note,startX,startY,endX,endY) {
	}
	,onResizeNote: function(note,startW,startH,endW,endH) {
	}
	,onEditNoteText: function(note) {
	}
	,onContextMenu: function(x,y,type,id) {
	}
	,onConnectionContextMenu: function(x,y,conn) {
	}
	,onContextMenuEvent: function(e) {
		e.preventDefault();
		var rect = this.canvas.getBoundingClientRect();
		var mx = e.clientX;
		var my = e.clientY;
		var canvasX = e.clientX - rect.left;
		var canvasY = e.clientY - rect.top;
		var worldX = (canvasX - this.offsetX) / this.scale;
		var worldY = (canvasY - this.offsetY) / this.scale;
		var node = this.getNodeAt(worldX,worldY);
		if(node != null) {
			this.onContextMenu(mx,my,"node",node.id);
			return;
		}
		var note = this.getNoteAt(worldX,worldY);
		if(note != null) {
			this.onContextMenu(mx,my,"note",note.id);
			return;
		}
		var conn = this.getConnectionAt(worldX,worldY);
		if(conn != null) {
			this.onConnectionContextMenu(mx,my,conn);
			return;
		}
	}
	,onDragOver: function(e) {
		e.preventDefault();
	}
	,onDrop: function(e) {
		e.preventDefault();
		var templateName = e.dataTransfer.getData("templateName");
		if(templateName != null && templateName != "") {
			var rect = this.canvas.getBoundingClientRect();
			var mx = e.clientX - rect.left;
			var my = e.clientY - rect.top;
			var worldX = (mx - this.offsetX) / this.scale;
			var worldY = (my - this.offsetY) / this.scale;
			this.onNodeCreate(templateName,worldX,worldY);
		}
	}
	,onMouseDown: function(e) {
		var rect = this.canvas.getBoundingClientRect();
		var mx = e.clientX - rect.left;
		var my = e.clientY - rect.top;
		var worldX = (mx - this.offsetX) / this.scale;
		var worldY = (my - this.offsetY) / this.scale;
		var note = this.getNoteAt(worldX,worldY);
		if(note != null) {
			if(worldX > note.x + note.width - 10 && worldY > note.y + note.height - 10) {
				this.isResizingNote = true;
				this.resizeNoteId = note.id;
				this.selectedNoteId = note.id;
				this.resizeStartWidth = note.width;
				this.resizeStartHeight = note.height;
				this.dragStartX = mx;
				this.dragStartY = my;
				return;
			}
			this.isDraggingNote = true;
			this.dragNoteId = note.id;
			this.selectedNoteId = note.id;
			this.selectedNodeId = null;
			this.selectedConnection = null;
			this.dragStartX = mx;
			this.dragStartY = my;
			this.nodeStartX = note.x;
			this.nodeStartY = note.y;
			return;
		}
		var node = this.getNodeAt(worldX,worldY);
		if(node != null) {
			if(worldX > node.x + 150 - 20) {
				this.isConnecting = true;
				this.connStartNodeId = node.id;
				this.mouseX = worldX;
				this.mouseY = worldY;
				this.selectedNodeId = null;
				this.selectedNoteId = null;
				this.selectedConnection = null;
				return;
			}
			this.isDraggingNode = true;
			this.dragNodeId = node.id;
			this.selectedNodeId = node.id;
			this.selectedNoteId = null;
			this.selectedConnection = null;
			this.dragStartX = mx;
			this.dragStartY = my;
			this.nodeStartX = node.x;
			this.nodeStartY = node.y;
			return;
		}
		var conn = this.getConnectionAt(worldX,worldY);
		if(conn != null) {
			this.selectedConnection = conn;
			this.selectedNodeId = null;
			this.selectedNoteId = null;
			return;
		}
		this.selectedNodeId = null;
		this.selectedNoteId = null;
		this.selectedConnection = null;
		this.isPanning = true;
		this.panStartX = mx;
		this.panStartY = my;
		this.panStartOffsetX = this.offsetX;
		this.panStartOffsetY = this.offsetY;
	}
	,onMouseMove: function(e) {
		var rect = this.canvas.getBoundingClientRect();
		var mx = e.clientX - rect.left;
		var my = e.clientY - rect.top;
		var worldX = (mx - this.offsetX) / this.scale;
		var worldY = (my - this.offsetY) / this.scale;
		this.mouseX = worldX;
		this.mouseY = worldY;
		if(this.isPanning) {
			var dx = mx - this.panStartX;
			var dy = my - this.panStartY;
			this.offsetX = this.panStartOffsetX + dx;
			this.offsetY = this.panStartOffsetY + dy;
		} else if(this.isDraggingNode) {
			var dx = (mx - this.dragStartX) / this.scale;
			var dy = (my - this.dragStartY) / this.scale;
			var node = this.findNode(this.dragNodeId);
			if(node != null) {
				node.x = this.nodeStartX + dx;
				node.y = this.nodeStartY + dy;
			}
		} else if(this.isDraggingNote) {
			var dx = (mx - this.dragStartX) / this.scale;
			var dy = (my - this.dragStartY) / this.scale;
			var note = this.findNoteById(this.dragNoteId);
			if(note != null) {
				note.x = this.nodeStartX + dx;
				note.y = this.nodeStartY + dy;
			}
		} else if(this.isResizingNote) {
			var dx = (mx - this.dragStartX) / this.scale;
			var dy = (my - this.dragStartY) / this.scale;
			var note = this.findNoteById(this.resizeNoteId);
			if(note != null) {
				note.width = Math.max(50,this.resizeStartWidth + dx);
				note.height = Math.max(50,this.resizeStartHeight + dy);
			}
		}
	}
	,onMouseUp: function(e) {
		if(this.isConnecting) {
			var endNode = this.getNodeAt(this.mouseX,this.mouseY);
			if(endNode != null && endNode.id != this.connStartNodeId) {
				this.onConnect(this.connStartNodeId,endNode.id);
			}
		}
		if(this.isDraggingNode && this.dragNodeId != null) {
			var node = this.findNode(this.dragNodeId);
			if(node != null) {
				this.onMoveNode(node,this.nodeStartX,this.nodeStartY,node.x,node.y);
			}
		}
		if(this.isDraggingNote && this.dragNoteId != null) {
			var note = this.findNoteById(this.dragNoteId);
			if(note != null) {
				this.onMoveNote(note,this.nodeStartX,this.nodeStartY,note.x,note.y);
			}
		}
		if(this.isResizingNote && this.resizeNoteId != null) {
			var note = this.findNoteById(this.resizeNoteId);
			if(note != null) {
				this.onResizeNote(note,this.resizeStartWidth,this.resizeStartHeight,note.width,note.height);
			}
		}
		this.isPanning = false;
		this.isDraggingNode = false;
		this.isDraggingNote = false;
		this.isResizingNote = false;
		this.isConnecting = false;
		this.dragNodeId = null;
		this.dragNoteId = null;
		this.resizeNoteId = null;
	}
	,onDoubleClick: function(e) {
		var rect = this.canvas.getBoundingClientRect();
		var mx = e.clientX - rect.left;
		var my = e.clientY - rect.top;
		var worldX = (mx - this.offsetX) / this.scale;
		var worldY = (my - this.offsetY) / this.scale;
		var node = this.getNodeAt(worldX,worldY);
		if(node != null) {
			this.onEditNode(node);
			return;
		}
		var note = this.getNoteAt(worldX,worldY);
		if(note != null) {
			this.onEditNoteText(note);
			return;
		}
		var connection = this.getConnectionAt(worldX,worldY);
		if(connection != null) {
			this.onEditConnection(connection);
		}
	}
	,onWheel: function(e) {
		e.preventDefault();
		var zoomIntensity = 0.1;
		var delta = e.deltaY < 0 ? 1 : -1;
		var zoom = Math.exp(delta * zoomIntensity);
		var rect = this.canvas.getBoundingClientRect();
		var mx = e.clientX - rect.left;
		var my = e.clientY - rect.top;
		var worldX = (mx - this.offsetX) / this.scale;
		var worldY = (my - this.offsetY) / this.scale;
		this.scale *= zoom;
		this.offsetX = mx - worldX * this.scale;
		this.offsetY = my - worldY * this.scale;
	}
	,onResize: function(e) {
		var parent = this.canvas.parentElement;
		this.canvas.width = parent.clientWidth;
		this.canvas.height = parent.clientHeight;
		this.draw();
	}
	,render: function(timestamp) {
		this.draw();
		window.requestAnimationFrame($bind(this,this.render));
	}
	,draw: function() {
		this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
		this.ctx.fillStyle = "#1e1e1e";
		this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
		this.drawGrid();
		var _g = 0;
		var _g1 = this.graph.edges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			this.drawConnection(edge);
		}
		if(this.isConnecting) {
			var startNode = this.findNode(this.connStartNodeId);
			if(startNode != null) {
				var sx = (startNode.x + 150) * this.scale + this.offsetX;
				var sy = (startNode.y + 25) * this.scale + this.offsetY;
				var tx = this.mouseX * this.scale + this.offsetX;
				var ty = this.mouseY * this.scale + this.offsetY;
				this.ctx.beginPath();
				this.ctx.moveTo(sx,sy);
				this.ctx.lineTo(tx,ty);
				this.ctx.strokeStyle = "#fff";
				this.ctx.setLineDash([5,5]);
				this.ctx.lineWidth = 2 * this.scale;
				this.ctx.stroke();
				this.ctx.setLineDash([]);
			}
		}
		var _g = 0;
		var _g1 = this.graph.nodes;
		while(_g < _g1.length) {
			var node = _g1[_g];
			++_g;
			this.drawNode(node);
		}
		var _g = 0;
		var _g1 = this.notes;
		while(_g < _g1.length) {
			var note = _g1[_g];
			++_g;
			this.drawNote(note);
		}
	}
	,drawGrid: function() {
		var gridSize = 20 * this.scale;
		this.ctx.save();
		this.ctx.translate(this.offsetX,this.offsetY);
		this.ctx.strokeStyle = "#2d2d2d";
		this.ctx.lineWidth = 1;
		this.ctx.beginPath();
		var startX = -this.offsetX;
		var startY = -this.offsetY;
		var endX = startX + this.canvas.width;
		var endY = startY + this.canvas.height;
		var firstLineX = Math.floor(startX / gridSize) * gridSize;
		var firstLineY = Math.floor(startY / gridSize) * gridSize;
		var x = firstLineX;
		while(x < endX) {
			this.ctx.moveTo(x,startY);
			this.ctx.lineTo(x,endY);
			x += gridSize;
		}
		var y = firstLineY;
		while(y < endY) {
			this.ctx.moveTo(startX,y);
			this.ctx.lineTo(endX,y);
			y += gridSize;
		}
		this.ctx.stroke();
		this.ctx.restore();
	}
	,drawNode: function(node) {
		var x = node.x * this.scale + this.offsetX;
		var y = node.y * this.scale + this.offsetY;
		var w = 150 * this.scale;
		var h = 50 * this.scale;
		this.ctx.fillStyle = "#34495e";
		if(node.id == this.selectedNodeId) {
			this.ctx.fillStyle = "#2980b9";
		}
		this.ctx.fillRect(x,y,w,h);
		this.ctx.fillStyle = "#ecf0f1";
		this.ctx.font = "" + 14 * this.scale + "px Arial";
		this.ctx.fillText(node.template.name,x + 10 * this.scale,y + 30 * this.scale);
		this.ctx.fillStyle = "#95a5a6";
		this.ctx.fillRect(x + w - 10 * this.scale,y + 10 * this.scale,10 * this.scale,30 * this.scale);
	}
	,drawNote: function(note) {
		var x = note.x * this.scale + this.offsetX;
		var y = note.y * this.scale + this.offsetY;
		var w = note.width * this.scale;
		var h = note.height * this.scale;
		this.ctx.fillStyle = "#f1c40f";
		if(note.id == this.selectedNoteId) {
			this.ctx.fillStyle = "#f39c12";
		}
		this.ctx.fillRect(x,y,w,h);
		this.ctx.fillStyle = "#2c3e50";
		this.ctx.font = "" + 12 * this.scale + "px Arial";
		var lineHeight = 16 * this.scale;
		var ty = y + 20 * this.scale;
		var margin = 5 * this.scale;
		var maxWidth = w - margin * 2;
		var paragraphs = note.text.split("\n");
		var _g = 0;
		while(_g < paragraphs.length) {
			var paragraph = paragraphs[_g];
			++_g;
			var words = paragraph.split(" ");
			var line = "";
			var _g1 = 0;
			while(_g1 < words.length) {
				var word = words[_g1];
				++_g1;
				var testLine = line + word + " ";
				var metrics = this.ctx.measureText(testLine);
				if(metrics.width > maxWidth && line.length > 0) {
					this.ctx.fillText(line,x + margin,ty);
					line = word + " ";
					ty += lineHeight;
				} else {
					line = testLine;
				}
			}
			this.ctx.fillText(line,x + margin,ty);
			ty += lineHeight;
		}
		this.ctx.fillStyle = "rgba(0,0,0,0.1)";
		this.ctx.beginPath();
		this.ctx.moveTo(x + w - 10 * this.scale,y + h);
		this.ctx.lineTo(x + w,y + h);
		this.ctx.lineTo(x + w,y + h - 10 * this.scale);
		this.ctx.fill();
	}
	,drawConnection: function(edge) {
		var sx = (edge.source.x + 150) * this.scale + this.offsetX;
		var sy = (edge.source.y + 25) * this.scale + this.offsetY;
		var tx = edge.target.x * this.scale + this.offsetX;
		var ty = (edge.target.y + 25) * this.scale + this.offsetY;
		this.ctx.beginPath();
		this.ctx.moveTo(sx,sy);
		this.ctx.lineTo(tx,ty);
		this.ctx.strokeStyle = "#bdc3c7";
		if(edge == this.selectedConnection) {
			this.ctx.strokeStyle = "#e74c3c";
		}
		this.ctx.lineWidth = 2 * this.scale;
		this.ctx.stroke();
		if(edge.edge.tag != null && edge.edge.tag.length > 0) {
			var midX = (sx + tx) / 2;
			var midY = (sy + ty) / 2;
			this.ctx.fillStyle = "#1e1e1e";
			this.ctx.font = "" + 12 * this.scale + "px Arial";
			var textWidth = this.ctx.measureText(edge.edge.tag).width;
			this.ctx.fillRect(midX - textWidth / 2 - 2,midY - 10 * this.scale,textWidth + 4,20 * this.scale);
			this.ctx.fillStyle = "#bdc3c7";
			if(edge == this.selectedConnection) {
				this.ctx.fillStyle = "#e74c3c";
			}
			this.ctx.textAlign = "center";
			this.ctx.textBaseline = "middle";
			this.ctx.fillText(edge.edge.tag,midX,midY);
			this.ctx.textAlign = "left";
			this.ctx.textBaseline = "alphabetic";
		}
	}
	,getNodeAt: function(x,y) {
		var _g = 0;
		var _g1 = this.graph.nodes.length;
		while(_g < _g1) {
			var i = _g++;
			var n = this.graph.nodes[this.graph.nodes.length - 1 - i];
			if(x >= n.x && x <= n.x + 150 && y >= n.y && y <= n.y + 50) {
				return n;
			}
		}
		return null;
	}
	,getConnectionAt: function(x,y) {
		var threshold = 5.0 / this.scale;
		var _g = 0;
		var _g1 = this.graph.edges;
		while(_g < _g1.length) {
			var edge = _g1[_g];
			++_g;
			var startNode = edge.source;
			var endNode = edge.target;
			var x1 = startNode.x + 150;
			var y1 = startNode.y + 25;
			var x2 = endNode.x;
			var y2 = endNode.y + 25;
			var A = x - x1;
			var B = y - y1;
			var C = x2 - x1;
			var D = y2 - y1;
			var dot = A * C + B * D;
			var len_sq = C * C + D * D;
			var param = -1.0;
			if(len_sq != 0) {
				param = dot / len_sq;
			}
			var xx = 0.0;
			var yy = 0.0;
			if(param < 0) {
				xx = x1;
				yy = y1;
			} else if(param > 1) {
				xx = x2;
				yy = y2;
			} else {
				xx = x1 + param * C;
				yy = y1 + param * D;
			}
			var dx = x - xx;
			var dy = y - yy;
			var distance = Math.sqrt(dx * dx + dy * dy);
			if(distance < threshold) {
				return edge;
			}
		}
		return null;
	}
	,findNode: function(id) {
		var _g = 0;
		var _g1 = this.graph.nodes;
		while(_g < _g1.length) {
			var n = _g1[_g];
			++_g;
			if(n.id == id) {
				return n;
			}
		}
		return null;
	}
	,findNoteById: function(id) {
		var _g = 0;
		var _g1 = this.notes;
		while(_g < _g1.length) {
			var n = _g1[_g];
			++_g;
			if(n.id == id) {
				return n;
			}
		}
		return null;
	}
	,getNoteAt: function(x,y) {
		var _g = 0;
		var _g1 = this.notes.length;
		while(_g < _g1) {
			var i = _g++;
			var n = this.notes[this.notes.length - 1 - i];
			if(x >= n.x && x <= n.x + n.width && y >= n.y && y <= n.y + n.height) {
				return n;
			}
		}
		return null;
	}
};
var ui_ContextMenu = function() {
	this.visible = false;
	var _gthis = this;
	this.element = window.document.createElement("div");
	this.element.style.position = "absolute";
	this.element.style.backgroundColor = "#2d2d2d";
	this.element.style.border = "1px solid #454545";
	this.element.style.padding = "5px 0";
	this.element.style.minWidth = "150px";
	this.element.style.zIndex = "1000";
	this.element.style.display = "none";
	this.element.style.boxShadow = "0 2px 5px rgba(0,0,0,0.5)";
	window.document.body.appendChild(this.element);
	window.document.addEventListener("click",function(e) {
		_gthis.hide();
	});
	window.document.addEventListener("contextmenu",function(e) {
		var tmp = e.target != window.document.getElementById("flowchart-canvas");
	});
};
ui_ContextMenu.__name__ = true;
ui_ContextMenu.prototype = {
	show: function(x,y,items) {
		var _gthis = this;
		this.element.innerHTML = "";
		var _g = 0;
		while(_g < items.length) {
			var item = [items[_g]];
			++_g;
			var itemEl = [window.document.createElement("div")];
			itemEl[0].innerText = item[0].label;
			itemEl[0].style.padding = "8px 15px";
			itemEl[0].style.cursor = "pointer";
			itemEl[0].style.color = "#ecf0f1";
			itemEl[0].style.fontFamily = "Arial, sans-serif";
			itemEl[0].style.fontSize = "14px";
			itemEl[0].onmouseover = (function(itemEl) {
				return function(e) {
					itemEl[0].style.backgroundColor = "#3498db";
				};
			})(itemEl);
			itemEl[0].onmouseout = (function(itemEl) {
				return function(e) {
					itemEl[0].style.backgroundColor = "transparent";
				};
			})(itemEl);
			itemEl[0].onclick = (function(item) {
				return function(e) {
					e.stopPropagation();
					_gthis.hide();
					item[0].action();
				};
			})(item);
			this.element.appendChild(itemEl[0]);
		}
		this.element.style.left = "" + x + "px";
		this.element.style.top = "" + y + "px";
		this.element.style.display = "block";
		this.visible = true;
	}
	,hide: function() {
		if(this.visible) {
			this.element.style.display = "none";
			this.visible = false;
		}
	}
};
var ui_DialogView = function(dialogId,customTypes) {
	this.dialog = window.document.getElementById(dialogId);
	this.formContainer = window.document.getElementById("editor-fields");
	this.btnConfirm = window.document.getElementById("btn-confirm");
	this.customTypes = customTypes != null ? customTypes : [];
	this.activeControls = new haxe_ds_StringMap();
	this.btnConfirm.addEventListener("click",$bind(this,this.onConfirm));
};
ui_DialogView.__name__ = true;
ui_DialogView.prototype = {
	onSave: function(node) {
	}
	,onSaveNote: function(note) {
	}
	,open: function(node) {
		this.currentNode = node;
		this.currentNote = null;
		this.formContainer.innerHTML = "";
		this.activeControls = new haxe_ds_StringMap();
		var titleDiv = window.document.createElement("div");
		titleDiv.className = "form-group";
		titleDiv.innerHTML = "<label>Type</label><input type=\"text\" value=\"" + node.template.name + "\" disabled>";
		this.formContainer.appendChild(titleDiv);
		var _g = 0;
		var _g1 = node.template.params;
		while(_g < _g1.length) {
			var param = _g1[_g];
			++_g;
			switch(param._hx_index) {
			case 0:
				var _g2 = param.defaultValue;
				var name = param.name;
				var desc = param.description;
				var val = Object.prototype.hasOwnProperty.call(node.data.h,name) ? node.data.h[name] : "";
				this.createField(desc,name,val,"text");
				break;
			case 1:
				var _g3 = param.defaultValue;
				var name1 = param.name;
				var desc1 = param.description;
				var val1 = Object.prototype.hasOwnProperty.call(node.data.h,name1) ? node.data.h[name1] : 0;
				this.createField(desc1,name1,val1,"number");
				break;
			case 2:
				var _g4 = param.defaultValue;
				var name2 = param.name;
				var desc2 = param.description;
				var val2 = Object.prototype.hasOwnProperty.call(node.data.h,name2) && node.data.h[name2];
				this.createField(desc2,name2,val2,"checkbox");
				break;
			case 3:
				var _g5 = param.defaultValue;
				var name3 = param.name;
				var desc3 = param.description;
				var val3 = Object.prototype.hasOwnProperty.call(node.data.h,name3) ? JSON.stringify(node.data.h[name3]) : "[]";
				this.createField(desc3,name3,val3,"text");
				break;
			case 4:
				var _g6 = param.defaultValue;
				var name4 = param.name;
				var desc4 = param.description;
				var options = param.options;
				var val4 = Object.prototype.hasOwnProperty.call(node.data.h,name4) ? node.data.h[name4] : options[0];
				this.createSelect(desc4,name4,val4,options);
				break;
			case 5:
				var _g7 = param.defaultValue;
				var name5 = param.name;
				var desc5 = param.description;
				var val5 = Object.prototype.hasOwnProperty.call(node.data.h,name5) ? node.data.h[name5] : "";
				this.createField(desc5,name5,val5,"textarea");
				break;
			case 6:
				var _g8 = param.defaultValue;
				var name6 = param.name;
				var desc6 = param.description;
				var val6 = Object.prototype.hasOwnProperty.call(node.data.h,name6) ? node.data.h[name6] : "";
				this.createField(desc6,name6,val6,"text");
				break;
			case 7:
				var name7 = param.name;
				var desc7 = param.description;
				var custom = param.custom;
				var val7 = Object.prototype.hasOwnProperty.call(node.data.h,name7) ? node.data.h[name7] : null;
				this.createCustomField(desc7,name7,val7,custom.typeName);
				break;
			}
		}
		this.dialog.showModal();
	}
	,openNote: function(note) {
		this.currentNote = note;
		this.currentNode = null;
		this.formContainer.innerHTML = "";
		this.createField("Note Text","note_text",note.text,"textarea");
		this.dialog.showModal();
	}
	,createCustomField: function(labelStr,name,value,typeName) {
		var div = window.document.createElement("div");
		div.className = "form-group";
		var label = window.document.createElement("label");
		label.innerText = labelStr;
		div.appendChild(label);
		var foundType = null;
		var _g = 0;
		var _g1 = this.customTypes;
		while(_g < _g1.length) {
			var ct = _g1[_g];
			++_g;
			if(ct.typeName == typeName) {
				foundType = ct;
				break;
			}
		}
		if(foundType != null) {
			var controlContainer = window.document.createElement("div");
			controlContainer.id = "custom_ctrl_" + name;
			div.appendChild(controlContainer);
			var control = foundType.renderControl(controlContainer.id,value);
			if(control != null) {
				this.activeControls.h[name] = control;
				var el = control.getElement();
				if(el != null && el.parentElement == null) {
					controlContainer.appendChild(el);
				}
			}
		} else {
			div.innerHTML += " <span>(Custom Type '" + typeName + "' not found)</span>";
		}
		this.formContainer.appendChild(div);
	}
	,createField: function(labelStr,name,value,type) {
		var div = window.document.createElement("div");
		div.className = "form-group";
		var label = window.document.createElement("label");
		label.innerText = labelStr;
		div.appendChild(label);
		if(type == "textarea") {
			var input = window.document.createElement("textarea");
			input.name = name;
			input.value = Std.string(value);
			input.style.width = "100%";
			input.style.minHeight = "150px";
			div.appendChild(input);
		} else if(type == "checkbox") {
			var input = window.document.createElement("input");
			input.name = name;
			input.type = "checkbox";
			input.checked = value == true;
			div.appendChild(input);
		} else {
			var input = window.document.createElement("input");
			input.name = name;
			input.value = Std.string(value);
			input.type = type;
			div.appendChild(input);
		}
		this.formContainer.appendChild(div);
	}
	,createSelect: function(labelStr,name,value,options) {
		var div = window.document.createElement("div");
		div.className = "form-group";
		var label = window.document.createElement("label");
		label.innerText = labelStr;
		div.appendChild(label);
		var select = window.document.createElement("select");
		select.name = name;
		var _g = 0;
		while(_g < options.length) {
			var opt = options[_g];
			++_g;
			var option = window.document.createElement("option");
			option.value = opt;
			option.text = opt;
			if(opt == Std.string(value)) {
				option.selected = true;
			}
			select.appendChild(option);
		}
		div.appendChild(select);
		this.formContainer.appendChild(div);
	}
	,onConfirm: function(e) {
		e.preventDefault();
		if(this.currentNote != null) {
			var inputs = this.formContainer.querySelectorAll("textarea");
			if(inputs.length > 0) {
				var el = inputs[0];
				this.currentNote.text = el.value;
				this.onSaveNote(this.currentNote);
			}
			this.dialog.close();
			return;
		}
		if(this.currentNode == null) {
			return;
		}
		var inputs = this.formContainer.querySelectorAll("input, textarea, select");
		var _g = 0;
		var _g1 = inputs.length;
		while(_g < _g1) {
			var i = _g++;
			var el = inputs[i];
			var name = el.name;
			var val = el.value;
			if(el.type == "checkbox") {
				val = el.checked;
			} else if(el.type == "number") {
				val = parseFloat(val);
			}
			var _g2 = 0;
			var _g3 = this.currentNode.template.params;
			while(_g2 < _g3.length) {
				var param = _g3[_g2];
				++_g2;
				var pName;
				switch(param._hx_index) {
				case 0:
					var _g4 = param.description;
					var _g5 = param.defaultValue;
					var n = param.name;
					pName = n;
					break;
				case 1:
					var _g6 = param.description;
					var _g7 = param.defaultValue;
					var n1 = param.name;
					pName = n1;
					break;
				case 2:
					var _g8 = param.description;
					var _g9 = param.defaultValue;
					var n2 = param.name;
					pName = n2;
					break;
				case 3:
					var _g10 = param.description;
					var _g11 = param.defaultValue;
					var n3 = param.name;
					pName = n3;
					break;
				case 4:
					var _g12 = param.description;
					var _g13 = param.defaultValue;
					var _g14 = param.options;
					var n4 = param.name;
					pName = n4;
					break;
				case 5:
					var _g15 = param.description;
					var _g16 = param.defaultValue;
					var n5 = param.name;
					pName = n5;
					break;
				case 6:
					var _g17 = param.description;
					var _g18 = param.defaultValue;
					var n6 = param.name;
					pName = n6;
					break;
				case 7:
					var _g19 = param.description;
					var _g20 = param.custom;
					var n7 = param.name;
					pName = n7;
					break;
				}
				if(pName == name) {
					switch(param._hx_index) {
					case 3:
						var _g21 = param.name;
						var _g22 = param.description;
						var _g23 = param.defaultValue;
						try {
							val = JSON.parse(val);
						} catch( _g24 ) {
						}
						this.currentNode.data.h[name] = val;
						break;
					case 7:
						var _g25 = param.name;
						var _g26 = param.description;
						var _g27 = param.custom;
						continue;
					default:
						this.currentNode.data.h[name] = val;
					}
					break;
				}
			}
		}
		var h = this.activeControls.h;
		var name_h = h;
		var name_keys = Object.keys(h);
		var name_length = name_keys.length;
		var name_current = 0;
		while(name_current < name_length) {
			var name = name_keys[name_current++];
			var control = this.activeControls.h[name];
			var val = control.getValue();
			this.currentNode.data.h[name] = val;
		}
		this.dialog.close();
		this.onSave(this.currentNode);
	}
};
var ui_OptionsDialog = function(dialogId) {
	this.dialog = window.document.getElementById(dialogId);
	this.formContainer = window.document.getElementById("options-fields");
	this.btnConfirm = window.document.getElementById("btn-options-confirm");
	if(this.btnConfirm != null) {
		this.btnConfirm.addEventListener("click",$bind(this,this.onConfirm));
	}
};
ui_OptionsDialog.__name__ = true;
ui_OptionsDialog.prototype = {
	onSave: function(defaultConnectionTag) {
	}
	,open: function(currentDefaultTag) {
		this.formContainer.innerHTML = "";
		this.createField("Default Connection Tag","default_connection_tag",currentDefaultTag,"text");
		this.dialog.showModal();
	}
	,createField: function(labelStr,name,value,type) {
		var div = window.document.createElement("div");
		div.className = "form-group";
		var label = window.document.createElement("label");
		label.innerText = labelStr;
		div.appendChild(label);
		var input = window.document.createElement("input");
		input.name = name;
		input.value = Std.string(value);
		input.type = type;
		div.appendChild(input);
		this.formContainer.appendChild(div);
	}
	,onConfirm: function(e) {
		e.preventDefault();
		var inputs = this.formContainer.querySelectorAll("input");
		var newTag = "";
		var _g = 0;
		var _g1 = inputs.length;
		while(_g < _g1) {
			var i = _g++;
			var el = inputs[i];
			if(el.name == "default_connection_tag") {
				newTag = el.value;
			}
		}
		this.dialog.close();
		this.onSave(newTag);
	}
};
var ui_PaletteView = function(containerId,templates) {
	this.searchQuery = "";
	this.currentCategory = "Common";
	this.container = window.document.getElementById(containerId);
	this.templates = templates;
	this.injectStyles();
	this.renderStructure();
	this.refresh();
};
ui_PaletteView.__name__ = true;
ui_PaletteView.prototype = {
	injectStyles: function() {
		var styleId = "palette-view-styles";
		if(window.document.getElementById(styleId) != null) {
			return;
		}
		var style = window.document.createElement("style");
		style.id = styleId;
		style.textContent = "\n            .palette-header {\n                display: flex;\n                flex-wrap: wrap;\n                background-color: #252526;\n                border-bottom: 1px solid #3e3e42;\n                padding: 5px;\n            }\n            .palette-tab {\n                padding: 5px 10px;\n                cursor: pointer;\n                color: #888;\n                font-size: 0.9em;\n                border-bottom: 2px solid transparent;\n                user-select: none;\n            }\n            .palette-tab:hover {\n                color: #ccc;\n            }\n            .palette-tab.active {\n                color: white;\n                border-bottom-color: #007acc;\n            }\n            .palette-search {\n                padding: 8px;\n                border-bottom: 1px solid #3e3e42;\n            }\n            .palette-search input {\n                width: 100%;\n                background-color: #333;\n                border: 1px solid #3e3e42;\n                color: white;\n                padding: 6px;\n                border-radius: 2px;\n                box-sizing: border-box;\n            }\n            .palette-list {\n                padding: 10px;\n                overflow-y: auto;\n                flex: 1;\n            }\n            .palette-item {\n                background-color: #333;\n                border: 1px solid #3e3e42;\n                padding: 10px;\n                margin-bottom: 8px;\n                border-radius: 4px;\n                cursor: grab;\n                transition: background-color 0.2s;\n                user-select: none;\n            }\n            .palette-item:hover {\n                background-color: #3c3c3c;\n                border-color: #007acc;\n            }\n        ";
		window.document.head.appendChild(style);
	}
	,renderStructure: function() {
		var _gthis = this;
		this.container.innerHTML = "";
		this.container.style.display = "flex";
		this.container.style.flexDirection = "column";
		this.container.style.height = "100%";
		this.headerContainer = window.document.createElement("div");
		this.headerContainer.className = "palette-header";
		this.container.appendChild(this.headerContainer);
		var searchContainer = window.document.createElement("div");
		searchContainer.className = "palette-search";
		this.searchInput = window.document.createElement("input");
		this.searchInput.type = "text";
		this.searchInput.placeholder = "Search Nodes...";
		this.searchInput.oninput = function(e) {
			_gthis.searchQuery = _gthis.searchInput.value.toLowerCase();
			_gthis.refresh();
		};
		searchContainer.appendChild(this.searchInput);
		this.container.appendChild(searchContainer);
		this.listContainer = window.document.createElement("div");
		this.listContainer.className = "palette-list";
		this.container.appendChild(this.listContainer);
	}
	,refresh: function() {
		this.renderHeader();
		this.renderList();
	}
	,renderHeader: function() {
		var _gthis = this;
		this.headerContainer.innerHTML = "";
		var categories_h = Object.create(null);
		var _g = 0;
		var _g1 = this.templates;
		while(_g < _g1.length) {
			var t = _g1[_g];
			++_g;
			var cat = t.category != null ? t.category : "Common";
			categories_h[cat] = true;
		}
		var categoryList = [];
		var h = categories_h;
		var c_h = h;
		var c_keys = Object.keys(h);
		var c_length = c_keys.length;
		var c_current = 0;
		while(c_current < c_length) {
			var c = c_keys[c_current++];
			categoryList.push(c);
		}
		categoryList.sort(function(a,b) {
			return Reflect.compare(a,b);
		});
		if(Object.prototype.hasOwnProperty.call(categories_h,"Common")) {
			HxOverrides.remove(categoryList,"Common");
			categoryList.unshift("Common");
		}
		var categoryExists = false;
		var _g = 0;
		while(_g < categoryList.length) {
			var c = categoryList[_g];
			++_g;
			if(c == this.currentCategory) {
				categoryExists = true;
				break;
			}
		}
		if(!categoryExists && categoryList.length > 0) {
			this.currentCategory = categoryList[0];
		}
		var _g = 0;
		while(_g < categoryList.length) {
			var c = [categoryList[_g]];
			++_g;
			var tab = window.document.createElement("div");
			tab.className = "palette-tab" + (c[0] == this.currentCategory ? " active" : "");
			tab.innerText = c[0];
			tab.onclick = (function(c) {
				return function() {
					_gthis.currentCategory = c[0];
					_gthis.refresh();
				};
			})(c);
			this.headerContainer.appendChild(tab);
		}
	}
	,renderList: function() {
		this.listContainer.innerHTML = "";
		this.templates.sort(function(a,b) {
			return Reflect.compare(a.name,b.name);
		});
		var count = 0;
		var _g = 0;
		var _g1 = this.templates;
		while(_g < _g1.length) {
			var t = [_g1[_g]];
			++_g;
			var cat = t[0].category != null ? t[0].category : "Common";
			if(this.searchQuery.length > 0) {
				if(t[0].name.toLowerCase().indexOf(this.searchQuery) == -1) {
					continue;
				}
			} else if(cat != this.currentCategory) {
				continue;
			}
			var div = window.document.createElement("div");
			div.className = "palette-item";
			div.innerText = t[0].name;
			div.draggable = true;
			div.addEventListener("dragstart",(function(t) {
				return function(e) {
					e.dataTransfer.setData("templateName",t[0].name);
				};
			})(t));
			this.listContainer.appendChild(div);
			++count;
		}
		if(count == 0) {
			var empty = window.document.createElement("div");
			empty.style.color = "#888";
			empty.style.textAlign = "center";
			empty.style.padding = "20px";
			empty.innerText = "No nodes found";
			this.listContainer.appendChild(empty);
		}
	}
};
var ui_PreviewDialog = function(dialogId) {
	this.dialog = window.document.getElementById(dialogId);
	this.titleEl = window.document.getElementById("preview-title");
	this.contentEl = window.document.getElementById("preview-content");
};
ui_PreviewDialog.__name__ = true;
ui_PreviewDialog.prototype = {
	showOptions: function(callbacks) {
		this.titleEl.innerText = "Select Preview";
		this.contentEl.innerHTML = "";
		var container = window.document.createElement("div");
		container.className = "preview-options";
		var btnTemplates = this.createButton("Templates",callbacks.onTemplates);
		var btnFlowchart = this.createButton("Flowchart",callbacks.onFlowchart);
		var btnCode = this.createButton("Code",callbacks.onCode);
		container.appendChild(btnTemplates);
		container.appendChild(btnFlowchart);
		container.appendChild(btnCode);
		this.contentEl.appendChild(container);
		if(!this.dialog.open) {
			this.dialog.showModal();
		}
	}
	,showContent: function(title,content) {
		this.titleEl.innerText = title;
		this.contentEl.innerHTML = "";
		var pre = window.document.createElement("pre");
		pre.innerText = content;
		this.contentEl.appendChild(pre);
	}
	,createButton: function(text,onClick) {
		var btn = window.document.createElement("button");
		btn.innerText = text;
		btn.onclick = function(e) {
			e.preventDefault();
			onClick();
		};
		return btn;
	}
};
var ui_Toast = function() { };
ui_Toast.__name__ = true;
ui_Toast.show = function(message) {
	if(ui_Toast.container == null) {
		ui_Toast.container = window.document.createElement("div");
		ui_Toast.container.style.position = "fixed";
		ui_Toast.container.style.bottom = "20px";
		ui_Toast.container.style.left = "50%";
		ui_Toast.container.style.transform = "translateX(-50%)";
		ui_Toast.container.style.zIndex = "2000";
		ui_Toast.container.style.pointerEvents = "none";
		window.document.body.appendChild(ui_Toast.container);
	}
	var toast = window.document.createElement("div");
	toast.innerText = message;
	toast.style.backgroundColor = "#333";
	toast.style.color = "#fff";
	toast.style.padding = "10px 20px";
	toast.style.marginBottom = "10px";
	toast.style.borderRadius = "4px";
	toast.style.boxShadow = "0 2px 5px rgba(0,0,0,0.3)";
	toast.style.opacity = "0";
	toast.style.transition = "opacity 0.3s ease";
	toast.style.fontFamily = "Arial, sans-serif";
	ui_Toast.container.appendChild(toast);
	window.requestAnimationFrame(function(_) {
		toast.style.opacity = "1";
	});
	haxe_Timer.delay(function() {
		toast.style.opacity = "0";
		haxe_Timer.delay(function() {
			if(toast.parentElement == ui_Toast.container) {
				ui_Toast.container.removeChild(toast);
			}
		},300);
	},3000);
};
function $bind(o,m) { if( m == null ) return null; if( m.__id__ == null ) m.__id__ = $global.$haxeUID++; var f; if( o.hx__closures__ == null ) o.hx__closures__ = {}; else f = o.hx__closures__[m.__id__]; if( f == null ) { f = m.bind(o); o.hx__closures__[m.__id__] = f; } return f; }
$global.$haxeUID |= 0;
if(typeof(performance) != "undefined" ? typeof(performance.now) == "function" : false) {
	HxOverrides.now = performance.now.bind(performance);
}
String.__name__ = true;
Array.__name__ = true;
Date.__name__ = "Date";
js_Boot.__toStr = ({ }).toString;
Main.main();
})(typeof window != "undefined" ? window : typeof global != "undefined" ? global : typeof self != "undefined" ? self : this);
